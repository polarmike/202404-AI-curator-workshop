<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Classifier</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <script src="https://cdn.elevenlabs.io/agent-widget.js"></script>
    <script type="module" src="js/main.js"></script>
</head>
<body>
    <div class="container">
        <h1>Image Classifier - Three Step Process</h1>
        
        <!-- Step indicators -->
        <div class="steps-container">
            <div id="step1" class="step active">
                <h3>Step 1</h3>
                <p>Upload Image</p>
            </div>
            <div id="step2" class="step">
                <h3>Step 2</h3>
                <p>Process & Analyze</p>
            </div>
            <div id="step3" class="step">
                <h3>Step 3</h3>
                <p>Interactive Chat</p>
            </div>
        </div>
        
        <!-- Main content area with new layout -->
        <div class="main-content">
            <!-- Step 1 Content: Upload Image -->
            <div id="step1-content" class="step-content active-step">
                <h2>Step 1: Upload Your Image</h2>
                
                <div class="instructions">
                    <h3>Instructions:</h3>
                    <p>Select an image file to upload for classification. The model works best with clear images where the subject is prominently visible.</p>
                </div>
                
                <!-- Image section with upload button -->
                <div class="image-section">
                    <div class="image-preview">
                        <h3>Image Preview</h3>
                        <div class="preview-container">
                            <div id="no-image" class="no-image-placeholder">
                                <p>No image uploaded</p>
                            </div>
                            <img id="preview" src="" alt="" style="display: none;">
                        </div>
                        <div id="image-info" style="display: none;">
                            <p id="image-name">Filename: </p>
                            <p id="image-size">Size: </p>
                        </div>
                    </div>
                    
                    <div class="image-controls">
                        <h3>Upload Image</h3>
                        <label for="image-upload">Select Image File:</label>
                        <input type="file" id="image-upload" accept="image/*">
                        <div class="model-input">
                            <label for="model-url">Teachable Machine Model URL:</label>
                            <input type="text" id="model-url" placeholder="https://teachablemachine.withgoogle.com/models/YOUR_MODEL_ID/model.json">
                        </div>
                        <button id="classify-button" class="classify-button">Classify Image</button>
                    </div>
                </div>
                
                <div class="button-container">
                    <div></div> <!-- Empty div for spacing -->
                    <button id="proceed-to-step2">Proceed to Analysis</button>
                </div>
            </div>
            
            <!-- Step 2 Content: Process & Analyze -->
            <div id="step2-content" class="step-content">
                <h2>Step 2: Process & Analyze Image</h2>
                
                <!-- Image section with image preview -->
                <div class="image-section">
                    <div class="image-preview">
                        <h3>Image Preview</h3>
                        <div class="preview-container" id="step2-preview-container">
                            <!-- Will show the same image from step 1 -->
                        </div>
                    </div>
                    
                    <div class="classification-results">
                        <h3>Classification</h3>
                        <div id="classification-progress" class="progress-indicator">
                            <div id="classification-progress-bar" class="progress-bar"></div>
                        </div>
                        
                        <div id="result-container" class="result-container">
                            <p id="result">Click "Classify Image" to see results.</p>
                        </div>
                    </div>
                </div>
                
                <h3 class="section-title">Image Description</h3>
                
                <div class="api-settings">
                    <h4>External AI Provider Settings</h4>
                    <div>
                        <label for="ai-provider">Select AI Provider:</label>
                        <select id="ai-provider">
                            <option value="local">Local (Basic Description)</option>
                            <option value="openai">OpenAI (GPT-4 Vision)</option>
                            <option value="deepseek">DeepSeek AI</option>
                        </select>
                    </div>
                    <div id="api-key-container" style="display: none;">
                        <label for="api-key">API Key:</label>
                        <input type="password" id="api-key" placeholder="Enter your API key">
                    </div>
                </div>
                
                <div id="description-container" class="result-container">
                    <p id="image-description">Click "Generate Description" to analyze the image.</p>
                    <div id="description-loader" style="display: none;">
                        <span class="loader"></span> Generating description...
                    </div>
                </div>
                
                <button id="generate-description" disabled>Generate Image Description</button>
                
                <div class="button-container">
                    <button id="back-to-step1">Back to Upload</button>
                    <button id="proceed-to-step3" disabled>Proceed to Chat</button>
                </div>
            </div>
            
            <!-- Step 3 Content: Interactive Chat -->
            <div id="step3-content" class="step-content">
                <h2>Step 3: Interact with AI Assistant</h2>
                
                <!-- Keep the image visible in step 3 as well -->
                <div class="image-section">
                    <div class="image-preview">
                        <h3>Image Preview</h3>
                        <div class="preview-container" id="step3-preview-container">
                            <!-- Will show the same image -->
                        </div>
                    </div>
                    
                    <div class="chat-instructions">
                        <div class="instructions">
                            <p>Ask the AI assistant about your image classification results and description. You can inquire about:</p>
                            <ul>
                                <li>Details about the classification results</li>
                                <li>Explanations of the image features</li>
                                <li>More information about detected objects</li>
                                <li>Suggestions based on the image content</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div id="agent-container">
                    <!-- Agent will be loaded here dynamically after classification -->
                    <elevenlabs-convai id="elevenlabs-agent" agent-id="dViYEOHPVrCL4viF7cij" dynamic-variables='{"classification_results": "No classification performed yet", "image_description": "No image analyzed yet"}'></elevenlabs-convai>
                </div>
                <div class="button-container">
                    <button id="back-to-step2">Back to Analysis</button>
                    <button id="reset-process">Start Over</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="script.js"></script>
</body>
</html>